
# Pull from master branch
- name: update git repo
  become: yes
  become_user: "{{ service_name }}"
  git:
      repo: https://github.com/haum/{{ service_name }}.git
      dest: /home/{{ service_name }}/{{ service_name }}
      update: yes
      version: "{{ version }}"
  register: git_updated

# Using sh instead of bash, so do NOT use `source` for venv
- name: reinstall upon update
  become: yes
  become_user: "{{ service_name }}"
  shell: . venv/bin/activate && pip install --upgrade .
  args:
      chdir: /home/{{ service_name }}/{{ service_name }}
  when: git_updated|changed
